# 报告生成系统多语言国际化 - 规范总结

## 📋 规范文件位置

所有规范文件已创建在 `.kiro/specs/report-i18n/` 目录下：

1. **需求文档** (requirements.md)
   - 10个用户故事，包含详细的验收标准
   - 6个功能需求（P0-P2优先级）
   - 4个非功能需求
   - 风险评估和成功指标

2. **设计文档** (design.md)
   - 完整的架构设计和数据流
   - 3个核心模块的详细设计
   - 翻译键命名规范和完整列表
   - LLM提示词设计（英文和中文版本）
   - 测试设计和性能优化方案

3. **任务列表** (tasks.md)
   - 150+ 个详细任务
   - 8个主要阶段
   - 每个任务都有明确的验收标准
   - 预计工时：5-7天

## 🎯 核心问题

### 当前状态
报告生成系统存在严重的多语言本地化问题：

1. **LLM提示词完全硬编码中文**（30+行）
2. **报告章节标题全部硬编码**（7个章节）
3. **PDF导出服务大量硬编码**（20+处）
4. **文件对话框和错误消息硬编码**（15+处）

### 影响
- 英文用户无法正常使用报告生成功能
- 生成的报告全部是中文界面
- 错误消息对英文用户不友好

## 🚀 解决方案

### 三层架构

```
用户界面 (语言设置)
    ↓
报告生成控制器 (国际化数据摘要)
    ↓
国际化层 (翻译键 + LLM提示词)
    ↓
LLM服务 (根据语言生成报告)
    ↓
导出服务 (国际化渲染)
```

### 核心组件

1. **国际化提示词模块** (`i18n/prompts.go`)
   - 管理英文和中文LLM提示词
   - 提供数据摘要模板
   - 支持动态语言切换

2. **翻译键系统** (150+ 新翻译键)
   - 报告章节标题
   - 页面元素文本
   - 错误消息
   - 文件对话框标题

3. **修改的文件**
   - `app_report_generate.go` - 报告生成控制器
   - `pdf_gopdf_service.go` - PDF导出服务
   - `app_dashboard_export.go` - 仪表盘导出
   - 其他导出服务（Word、Excel、PPT）

## 📊 实施计划

### 阶段1: 准备工作（第1天）
- ✅ 创建 `i18n/prompts.go`
- ✅ 添加150+翻译键
- ✅ 创建辅助函数

### 阶段2: 核心功能（第2-3天）
- 修改报告生成控制器
- 修改PDF导出服务
- 修改仪表盘导出

### 阶段3: 测试（第4天）
- 单元测试
- 集成测试（英文/中文）
- 语言切换测试
- LLM输出质量测试

### 阶段4: 其他格式（第5天，可选）
- Word导出
- Excel导出
- PPT导出

### 阶段5: 文档和发布（第6-7天）
- 更新文档
- 代码审查
- 部署准备

## 🎓 快速开始

### 第一步：创建提示词模块

创建 `src/i18n/prompts.go`，包含：
- `reportSystemPrompts` - 英文和中文系统提示词
- `reportUserPromptTemplates` - 用户提示词模板
- `dataSummaryTemplates` - 数据摘要模板
- `GetReportSystemPrompt()` - 获取提示词函数

### 第二步：添加翻译键

在 `translations_en.go` 和 `translations_zh.go` 中添加：
- 对话框标题
- 文件名前缀
- 错误消息
- 章节标题
- 页面元素

### 第三步：修改代码

1. **报告生成控制器**
   ```go
   systemPrompt := i18n.GetReportSystemPrompt()
   ```

2. **数据摘要构建**
   ```go
   sb.WriteString(i18n.GetDataSummaryTemplate("user_request") + "\n")
   ```

3. **PDF导出服务**
   ```go
   y := s.addSectionTitle(pdf, i18n.T("report.section.key_indicators"), fontName)
   ```

## ✅ 验收标准

### 功能验收
- [ ] 英文用户可以生成完整的英文报告
- [ ] 中文用户可以生成完整的中文报告
- [ ] 语言切换功能正常
- [ ] 所有导出格式支持多语言

### 质量验收
- [ ] 无硬编码的用户可见字符串
- [ ] 所有翻译键都有对应的翻译
- [ ] 测试覆盖率 > 80%
- [ ] 报告质量保持一致

### 性能验收
- [ ] 报告生成时间无明显增加
- [ ] 翻译查找时间 < 1ms
- [ ] 内存使用无明显增加

## 📚 相关文档

### 规范文档
- `.kiro/specs/report-i18n/requirements.md` - 需求文档
- `.kiro/specs/report-i18n/design.md` - 设计文档
- `.kiro/specs/report-i18n/tasks.md` - 任务列表

### 参考文档
- `doc/REPORT_I18N_ANALYSIS.md` - 问题分析
- `doc/REPORT_I18N_QUICK_START.md` - 快速开始指南
- `doc/I18N_OVERVIEW.md` - 国际化系统概述
- `doc/I18N_IMPLEMENTATION_PLAN.md` - 国际化实施计划

## 🎯 成功指标

- 英文用户满意度 > 90%
- 中文用户满意度 > 90%
- 报告生成成功率 > 99%
- 语言切换成功率 = 100%
- 零硬编码字符串
- 测试覆盖率 > 80%

## 🚨 风险和缓解

### 高风险
**LLM提示词翻译质量**
- 风险：英文提示词可能无法达到中文提示词的效果
- 缓解：请母语者审查，充分测试，必要时调整措辞

### 中风险
**报告格式不一致**
- 风险：不同语言生成的报告格式可能不一致
- 缓解：使用相同的报告结构模板，测试两种语言的输出

**字体支持问题**
- 风险：PDF中英文字体可能显示不正确
- 缓解：使用支持多语言的字体，提供字体回退机制

## 📞 获取帮助

### 文档资源
- 查看完整规范：`.kiro/specs/report-i18n/`
- 查看快速开始：`doc/REPORT_I18N_QUICK_START.md`
- 查看问题分析：`doc/REPORT_I18N_ANALYSIS.md`

### 开发资源
- 国际化系统文档：`src/i18n/README.md`
- 国际化概述：`doc/I18N_OVERVIEW.md`
- 迁移指南：`doc/I18N_MIGRATION_GUIDE.md`

## 🎉 下一步行动

1. **阅读规范文档**
   - 需求文档：了解用户故事和验收标准
   - 设计文档：了解架构和实现细节
   - 任务列表：了解具体任务和时间安排

2. **开始实施**
   - 按照快速开始指南创建提示词模块
   - 添加翻译键
   - 修改报告生成控制器

3. **测试验证**
   - 运行单元测试
   - 运行集成测试
   - 手动测试英文和中文报告

4. **完善和优化**
   - 修复发现的问题
   - 优化性能
   - 更新文档

---

**规范状态**: ✅ 已完成  
**实施状态**: ⏳ 待开始  
**预计完成**: 5-7天  
**优先级**: P0（紧急）

**准备好了吗？让我们开始吧！** 🚀
