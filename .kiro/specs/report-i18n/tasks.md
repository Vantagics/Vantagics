# 报告生成系统多语言国际化 - 任务列表

## 1. 准备工作

### 1.1 创建国际化提示词模块
- [ ] 创建 `src/i18n/prompts.go` 文件
- [ ] 定义 `reportSystemPrompts` 映射（英文和中文）
- [ ] 定义 `reportUserPromptTemplates` 映射
- [ ] 定义 `dataSummaryTemplates` 映射
- [ ] 实现 `GetReportSystemPrompt()` 函数
- [ ] 实现 `GetReportUserPromptTemplate()` 函数
- [ ] 实现 `GetDataSummaryTemplate()` 函数
- [ ] 添加单元测试

### 1.2 添加翻译键
- [ ] 在 `translations_en.go` 中添加所有报告相关翻译键
- [ ] 在 `translations_zh.go` 中添加所有报告相关翻译键
- [ ] 验证翻译键的完整性和一致性
- [ ] 请母语者审查英文翻译
- [ ] 请母语者审查中文翻译

### 1.3 创建辅助函数
- [ ] 创建 `formatTimestamp()` 函数（日期时间格式化）
- [ ] 创建 `formatDate()` 函数（日期格式化）
- [ ] 添加单元测试

## 2. 核心功能实现

### 2.1 修改报告生成控制器 (app_report_generate.go)

#### 2.1.1 修改 PrepareReport 函数
- [ ] 添加语言检测逻辑
- [ ] 确保语言设置正确传递

#### 2.1.2 修改 callLLMForReport 函数
- [ ] 导入 `i18n` 包
- [ ] 使用 `i18n.GetReportSystemPrompt()` 获取系统提示词
- [ ] 使用 `i18n.GetReportUserPromptTemplate()` 获取用户提示词模板
- [ ] 测试LLM调用

#### 2.1.3 修改 buildDataSummary 函数
- [ ] 使用 `i18n.GetDataSummaryTemplate("user_request")` 替换硬编码
- [ ] 使用 `i18n.GetDataSummaryTemplate("data_source")` 替换硬编码
- [ ] 使用 `i18n.GetDataSummaryTemplate("key_metrics")` 替换硬编码
- [ ] 使用 `i18n.GetDataSummaryTemplate("insights")` 替换硬编码
- [ ] 使用 `i18n.GetDataSummaryTemplate("data_table")` 替换硬编码
- [ ] 使用 `i18n.GetDataSummaryTemplate("multiple_tables")` 替换硬编码
- [ ] 使用 `i18n.GetDataSummaryTemplate("charts")` 替换硬编码
- [ ] 测试数据摘要构建

#### 2.1.4 修改文件对话框
- [ ] 修改 `doExportWord()` 中的对话框标题
- [ ] 修改 `doExportWord()` 中的默认文件名
- [ ] 修改 `doExportPDF()` 中的对话框标题
- [ ] 修改 `doExportPDF()` 中的默认文件名
- [ ] 测试文件对话框

#### 2.1.5 修改错误消息
- [ ] 修改 "LLM 服务未初始化" 错误消息
- [ ] 修改 "报告生成失败" 错误消息
- [ ] 修改 "报告数据已过期" 错误消息
- [ ] 修改 "Word文档生成失败" 错误消息
- [ ] 修改 "PDF生成失败" 错误消息
- [ ] 测试错误消息显示

### 2.2 修改PDF导出服务 (pdf_gopdf_service.go)

#### 2.2.1 修改章节标题
- [ ] 导入 `i18n` 包
- [ ] 修改 `addMetricsSection()` 中的章节标题
- [ ] 修改 `addChartsSection()` 中的章节标题
- [ ] 修改 `addTableSection()` 中的章节标题
- [ ] 测试章节标题显示

#### 2.2.2 修改页面元素
- [ ] 修改 `addCoverPage()` 中的数据源标签
- [ ] 修改 `addCoverPage()` 中的分析请求标签
- [ ] 修改 `addCoverPage()` 中的生成时间标签
- [ ] 使用 `formatTimestamp()` 格式化时间
- [ ] 测试页面元素显示

#### 2.2.3 修改图表标签
- [ ] 修改 `addChartsSection()` 中的图表标签
- [ ] 使用参数化翻译（图表 X / Y）
- [ ] 测试图表标签显示

#### 2.2.4 修改表格信息
- [ ] 修改 `addTableSection()` 中的总行数文本
- [ ] 修改 `addTableSection()` 中的显示列数文本
- [ ] 修改 `parseKeyValueLines()` 中的分类标签
- [ ] 测试表格信息显示

#### 2.2.5 修改页脚
- [ ] 修改 `addPageFooters()` 中的页脚文本
- [ ] 测试页脚显示

#### 2.2.6 修改错误消息
- [ ] 修改 "无法加载中文字体" 错误消息
- [ ] 测试错误消息显示

### 2.3 修改仪表盘导出 (app_dashboard_export.go)

#### 2.3.1 修改文件对话框
- [ ] 修改 `ExportDashboardToPDF()` 中的对话框标题
- [ ] 修改 `ExportTableToExcel()` 中的对话框标题
- [ ] 修改 `ExportDashboardToExcel()` 中的对话框标题
- [ ] 修改 `ExportMessageToPDF()` 中的对话框标题
- [ ] 修改 `ExportDashboardToPPT()` 中的对话框标题
- [ ] 修改 `ExportDashboardToWord()` 中的对话框标题

#### 2.3.2 修改默认文件名
- [ ] 修改所有导出函数中的默认文件名前缀
- [ ] 使用 `i18n.T("report.filename_prefix")`

#### 2.3.3 修改错误消息
- [ ] 修改 "PDF生成失败" 错误消息
- [ ] 修改 "Excel生成失败" 错误消息
- [ ] 修改 "PPT生成失败" 错误消息
- [ ] 修改 "Word生成失败" 错误消息
- [ ] 修改 "没有可导出的内容" 错误消息

#### 2.3.4 修改工作表名称
- [ ] 修改 "数据分析" 工作表名称
- [ ] 修改 "表格%d" 工作表名称

## 3. 其他导出格式（可选）

### 3.1 修改Word导出服务 (word_service.go)
- [ ] 审查硬编码字符串
- [ ] 使用 `i18n.T()` 替换硬编码
- [ ] 测试Word导出

### 3.2 修改Excel导出服务 (excel_goexcel_service.go)
- [ ] 审查硬编码字符串
- [ ] 使用 `i18n.T()` 替换硬编码
- [ ] 测试Excel导出

### 3.3 修改PPT导出服务 (ppt_goppt_service.go)
- [ ] 审查硬编码字符串
- [ ] 使用 `i18n.T()` 替换硬编码
- [ ] 测试PPT导出

## 4. 测试

### 4.1 单元测试
- [ ] 测试 `GetReportSystemPrompt()` 函数
- [ ] 测试 `GetReportUserPromptTemplate()` 函数
- [ ] 测试 `GetDataSummaryTemplate()` 函数
- [ ] 测试 `formatTimestamp()` 函数
- [ ] 测试 `formatDate()` 函数
- [ ] 测试 `buildDataSummary()` 函数
- [ ] 验证测试覆盖率 > 80%

### 4.2 集成测试

#### 4.2.1 英文环境测试
- [ ] 设置语言为English
- [ ] 生成包含指标的PDF报告
- [ ] 验证报告标题为英文
- [ ] 验证章节标题为英文
- [ ] 验证页面元素为英文
- [ ] 验证页脚为英文
- [ ] 验证文件对话框标题为英文
- [ ] 验证默认文件名为英文
- [ ] 生成包含图表的报告
- [ ] 验证图表标签为英文
- [ ] 生成包含表格的报告
- [ ] 验证表格信息为英文
- [ ] 触发错误，验证错误消息为英文

#### 4.2.2 中文环境测试
- [ ] 设置语言为简体中文
- [ ] 生成包含指标的PDF报告
- [ ] 验证报告标题为中文
- [ ] 验证章节标题为中文
- [ ] 验证页面元素为中文
- [ ] 验证页脚为中文
- [ ] 验证文件对话框标题为中文
- [ ] 验证默认文件名为中文
- [ ] 生成包含图表的报告
- [ ] 验证图表标签为中文
- [ ] 生成包含表格的报告
- [ ] 验证表格信息为中文
- [ ] 触发错误，验证错误消息为中文

#### 4.2.3 语言切换测试
- [ ] 从英文切换到中文，生成报告
- [ ] 验证报告为中文
- [ ] 从中文切换到英文，生成报告
- [ ] 验证报告为英文
- [ ] 多次切换语言，验证每次都正确

#### 4.2.4 LLM输出质量测试
- [ ] 测试英文提示词生成的报告质量
- [ ] 测试中文提示词生成的报告质量
- [ ] 验证报告结构符合要求
- [ ] 验证章节标题正确
- [ ] 验证内容组织合理
- [ ] 验证没有生成Markdown表格

#### 4.2.5 边界情况测试
- [ ] 空数据测试（无指标、无图表、无表格）
- [ ] 大量数据测试（100+行表格）
- [ ] 特殊字符测试（emoji、特殊符号）
- [ ] 多表格测试（5+个表格）
- [ ] 多图表测试（10+个图表）
- [ ] 长文本测试（超长分析请求）
- [ ] 混合语言测试（中英文混合内容）

### 4.3 端到端测试
- [ ] 完整的用户流程测试（英文）
- [ ] 完整的用户流程测试（中文）
- [ ] 语言切换流程测试
- [ ] 多格式导出测试
- [ ] 错误恢复测试

### 4.4 性能测试
- [ ] 测试报告生成时间（英文）
- [ ] 测试报告生成时间（中文）
- [ ] 测试翻译查找性能
- [ ] 测试内存使用
- [ ] 验证性能无明显下降

## 5. 文档更新

### 5.1 更新国际化文档
- [ ] 更新 `I18N_OVERVIEW.md`
- [ ] 更新 `I18N_IMPLEMENTATION_PLAN.md`
- [ ] 更新 `I18N_MIGRATION_GUIDE.md`
- [ ] 更新 `src/i18n/README.md`

### 5.2 创建使用示例
- [ ] 创建报告生成国际化示例
- [ ] 创建LLM提示词使用示例
- [ ] 创建日期格式化示例

### 5.3 更新API文档
- [ ] 更新报告生成API文档
- [ ] 更新导出服务API文档
- [ ] 添加国际化相关说明

### 5.4 创建测试报告
- [ ] 记录测试结果
- [ ] 记录发现的问题
- [ ] 记录性能数据
- [ ] 创建测试总结

## 6. 代码审查和优化

### 6.1 代码审查
- [ ] 审查所有修改的代码
- [ ] 检查是否有遗漏的硬编码字符串
- [ ] 检查代码风格和规范
- [ ] 检查错误处理

### 6.2 性能优化
- [ ] 优化翻译查找
- [ ] 优化LLM提示词长度
- [ ] 优化报告生成流程
- [ ] 优化PDF渲染性能

### 6.3 安全审查
- [ ] 审查输入验证
- [ ] 审查输出清理
- [ ] 审查错误消息（避免泄露敏感信息）

## 7. 部署准备

### 7.1 向后兼容性验证
- [ ] 验证现有API接口不变
- [ ] 验证现有报告缓存仍然有效
- [ ] 验证默认行为正确

### 7.2 配置管理
- [ ] 验证语言设置存储正确
- [ ] 验证环境变量支持
- [ ] 验证命令行参数支持

### 7.3 监控和日志
- [ ] 添加语言切换日志
- [ ] 添加报告生成日志
- [ ] 添加LLM调用统计

## 8. 发布

### 8.1 发布准备
- [ ] 创建发布说明
- [ ] 更新版本号
- [ ] 创建变更日志

### 8.2 发布验证
- [ ] 在测试环境验证
- [ ] 在预生产环境验证
- [ ] 获得审批

### 8.3 发布执行
- [ ] 部署到生产环境
- [ ] 监控系统状态
- [ ] 收集用户反馈

---

**任务总数**: 150+  
**预计工时**: 5-7天  
**优先级**: P0（紧急）  
**状态**: 待开始
