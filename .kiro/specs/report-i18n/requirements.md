# 报告生成系统多语言国际化 - 需求文档

## 1. 项目概述

### 1.1 背景
当前报告生成系统（PDF、Word、Excel、PPT导出）存在大量硬编码的中文字符串，导致英文用户无法正常使用报告生成功能。需要对整个报告生成系统进行多语言国际化改造。

### 1.2 目标
- 支持英文和简体中文两种语言的报告生成
- 根据用户语言设置自动切换报告语言
- 确保LLM能够理解并生成对应语言的报告
- 保持报告质量和格式一致性

### 1.3 范围
- 报告生成核心逻辑（`app_report_generate.go`）
- PDF导出服务（`pdf_gopdf_service.go`）
- Word导出服务（`word_service.go`）
- Excel导出服务（`excel_goexcel_service.go`）
- 仪表盘导出（`app_dashboard_export.go`）

## 2. 用户故事

### 2.1 英文用户生成报告
**作为** 英文用户  
**我想要** 生成英文的分析报告  
**以便** 我能够理解报告内容并与英文团队分享

**验收标准**:
- [ ] 设置语言为English后，生成的PDF报告所有文本为英文
- [ ] 报告标题、章节标题、页面元素全部为英文
- [ ] 文件保存对话框标题为英文
- [ ] 默认文件名为英文格式（如 "Analysis_Report_20240208_150405.pdf"）
- [ ] LLM生成的报告内容结构符合英文习惯
- [ ] 错误消息为英文

### 2.2 中文用户生成报告
**作为** 中文用户  
**我想要** 生成中文的分析报告  
**以便** 我能够理解报告内容并与中文团队分享

**验收标准**:
- [ ] 设置语言为简体中文后，生成的PDF报告所有文本为中文
- [ ] 报告标题、章节标题、页面元素全部为中文
- [ ] 文件保存对话框标题为中文
- [ ] 默认文件名为中文格式（如 "分析报告_20240208_150405.pdf"）
- [ ] LLM生成的报告内容结构符合中文习惯
- [ ] 错误消息为中文

### 2.3 语言切换
**作为** 用户  
**我想要** 能够切换语言后立即生成对应语言的报告  
**以便** 我可以灵活地为不同受众生成报告

**验收标准**:
- [ ] 从英文切换到中文后，新生成的报告为中文
- [ ] 从中文切换到英文后，新生成的报告为英文
- [ ] 语言切换不需要重启应用
- [ ] 已缓存的报告ID在语言切换后仍然有效

### 2.4 多格式导出
**作为** 用户  
**我想要** 所有导出格式（PDF、Word、Excel、PPT）都支持多语言  
**以便** 我可以选择最适合的格式分享报告

**验收标准**:
- [ ] PDF导出支持英文和中文
- [ ] Word导出支持英文和中文
- [ ] Excel导出支持英文和中文
- [ ] PPT导出支持英文和中文
- [ ] 所有格式的文件对话框标题和默认文件名都国际化

## 3. 功能需求

### 3.1 LLM提示词国际化
**优先级**: P0（紧急）

**需求描述**:
- 创建英文和中文两个版本的LLM系统提示词
- 根据用户语言设置选择对应的提示词
- 确保两个版本的提示词产生相同质量的报告

**技术要求**:
- 创建 `src/i18n/prompts.go` 文件
- 定义 `reportSystemPrompts` 映射
- 实现 `GetReportSystemPrompt()` 函数
- 提示词长度控制在合理范围内（避免token浪费）

### 3.2 数据摘要构建国际化
**优先级**: P0（紧急）

**需求描述**:
- 将传递给LLM的数据摘要中的所有章节标题国际化
- 确保LLM能够理解对应语言的数据结构

**技术要求**:
- 修改 `buildDataSummary()` 函数
- 所有章节标题使用 `i18n.T()` 函数
- 保持数据摘要的结构清晰

### 3.3 PDF导出国际化
**优先级**: P0（紧急）

**需求描述**:
- PDF报告中的所有文本元素国际化
- 包括章节标题、页面元素、图表标签、表格信息、页脚等

**技术要求**:
- 修改 `pdf_gopdf_service.go` 中的所有硬编码字符串
- 使用 `i18n.T()` 函数替换
- 确保字体支持多语言显示

### 3.4 文件对话框国际化
**优先级**: P1（高）

**需求描述**:
- 所有文件保存对话框的标题国际化
- 默认文件名根据语言生成

**技术要求**:
- 修改所有 `runtime.SaveFileDialog()` 调用
- 标题使用 `i18n.T()`
- 文件名前缀根据语言选择

### 3.5 错误消息国际化
**优先级**: P1（高）

**需求描述**:
- 所有错误消息国际化
- 确保用户能够理解错误原因

**技术要求**:
- 修改所有 `fmt.Errorf()` 调用
- 使用 `i18n.T()` 包装错误消息
- 保持错误消息的清晰性

### 3.6 其他导出格式国际化
**优先级**: P2（中）

**需求描述**:
- Word、Excel、PPT导出也支持多语言

**技术要求**:
- 修改对应的导出服务
- 使用统一的国际化方法

## 4. 非功能需求

### 4.1 性能要求
- 国际化不应显著影响报告生成速度
- 翻译查找时间应小于1ms
- LLM调用时间保持不变

### 4.2 兼容性要求
- 向后兼容现有的报告生成API
- 不破坏现有的缓存机制
- 支持Windows、macOS、Linux

### 4.3 可维护性要求
- 所有翻译键集中管理
- 代码结构清晰，易于添加新语言
- 提供完整的文档和示例

### 4.4 测试要求
- 单元测试覆盖率 > 80%
- 集成测试覆盖所有导出格式
- 手动测试覆盖所有用户场景

## 5. 约束条件

### 5.1 技术约束
- 必须使用现有的 `i18n` 包
- 不能修改LLM API接口
- 必须保持现有的报告格式和质量

### 5.2 时间约束
- 核心功能（P0）必须在5天内完成
- 完整功能（P0+P1）必须在7天内完成
- 所有功能（P0+P1+P2）必须在10天内完成

### 5.3 资源约束
- 开发人员：1人
- 测试人员：1人
- 翻译审查：需要母语者

## 6. 验收标准

### 6.1 功能验收
- [ ] 所有P0功能完成并测试通过
- [ ] 所有P1功能完成并测试通过
- [ ] 英文和中文报告质量相当
- [ ] 语言切换功能正常

### 6.2 质量验收
- [ ] 无硬编码的用户可见字符串
- [ ] 所有翻译键都有对应的翻译
- [ ] 代码通过静态分析
- [ ] 测试覆盖率达标

### 6.3 文档验收
- [ ] 更新国际化文档
- [ ] 提供使用示例
- [ ] 更新API文档
- [ ] 提供测试报告

## 7. 风险评估

### 7.1 高风险
- **LLM提示词翻译质量**: 英文提示词可能无法达到中文提示词的效果
  - 缓解措施：请母语者审查，充分测试，必要时调整措辞

### 7.2 中风险
- **报告格式不一致**: 不同语言生成的报告格式可能不一致
  - 缓解措施：使用相同的报告结构模板，测试两种语言的输出

- **字体支持问题**: PDF中英文字体可能显示不正确
  - 缓解措施：使用支持多语言的字体，提供字体回退机制

### 7.3 低风险
- **日期时间格式**: 不同语言的日期时间格式不同
  - 缓解措施：根据语言设置选择格式，使用标准格式化

## 8. 依赖关系

### 8.1 前置依赖
- ✅ `i18n` 包已实现
- ✅ 翻译基础设施已搭建
- ✅ 语言切换机制已实现

### 8.2 后续依赖
- 前端报告预览功能需要同步更新
- 报告模板系统需要支持多语言
- 报告分享功能需要考虑语言标识

## 9. 里程碑

### 里程碑1: 核心功能完成（第3天）
- LLM提示词国际化
- 数据摘要构建国际化
- PDF导出国际化

### 里程碑2: 完整功能完成（第5天）
- 文件对话框国际化
- 错误消息国际化
- 基本测试完成

### 里程碑3: 全部功能完成（第7天）
- 其他导出格式国际化
- 完整测试完成
- 文档更新完成

## 10. 成功指标

- 英文用户满意度 > 90%
- 中文用户满意度 > 90%
- 报告生成成功率 > 99%
- 语言切换成功率 = 100%
- 零硬编码字符串
- 测试覆盖率 > 80%

---

**文档版本**: 1.0  
**创建日期**: 2024-02-08  
**负责人**: [待指定]  
**状态**: 待审批
