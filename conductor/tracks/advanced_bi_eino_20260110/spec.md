# Specification: Advanced BI Analysis with Eino Agent Framework

## Overview
This track aims to implement a sophisticated Business Intelligence (BI) analysis agent using the **Eino** framework. The agent will act as a data-centric assistant within the RapidBI chat interface, guiding users through deep data exploration, generating multi-modal insights (text, charts, tables), and providing an extensible "Skills" system based on Python scripts for advanced users.

## Functional Requirements

### 1. Eino-Based Agent Core
- Implement a robust agentic workflow using Eino's graph/chain composition.
- Integrate **Anthropic** (via Claude-compatible API) as the primary LLM, utilizing its advanced reasoning and tool-calling capabilities.
- Maintain conversation memory within the Eino graph to support multi-turn analysis.

### 2. Guided Data Exploration
- **Proactive Insights:** Upon selecting a data source, the agent automatically analyzes the schema and suggests relevant metrics or questions.
- **Hybrid Interaction:** Support both open-ended natural language queries and structured "wizard-style" interactions (e.g., interactive buttons for selecting dimensions/metrics).
- **Conversational Drill-down:** The agent should proactively ask clarifying questions to refine analysis goals.

### 3. Metadata-Driven Python Analysis
- The agent will perform analysis by generating and executing Python scripts.
- **Workflow:**
    1. Agent receives schema and data sample.
    2. Agent generates Python code using libraries like `pandas`, `matplotlib`, or `seaborn`.
    3. Code is executed in the user's configured Python environment.
    4. Results (dataframes, chart images, etc.) are captured and returned to the chat.

### 4. Multi-Modal Outputs
- **Text:** Natural language summaries and narrative insights.
- **Static Visuals:** Display chart images generated by Python.
- **Interactive Visuals:** Render JSON-based interactive charts (e.g., ECharts) in the frontend.
- **Structured Data:** Render data tables for raw or aggregated results.
- **Export:** Support generation of PDF or Excel reports upon user request.

### 5. Advanced User "Skills" (Plugins)
- Allow advanced users to define custom "Skills" as Python scripts.
- These skills will be registered as tools/functions that the Eino agent can call.
- Skills should have access to the data source and standard BI libraries.

## Non-Functional Requirements
- **Performance:** Python execution should be handled asynchronously to prevent UI freezing.
- **Security:** Python scripts must be executed within the context of the user's local environment, with clear logging of executed code.
- **Extensibility:** The Eino graph should be designed to easily add new tools or modify the reasoning logic.

## Acceptance Criteria
- [ ] A new Eino agent is initialized and integrated into the chat service.
- [ ] Selecting a data source triggers an initial "Smart Suggestion" response.
- [ ] Users can perform complex BI tasks (e.g., "Show me the monthly sales trend and highlight any anomalies") and receive a combination of text and charts.
- [ ] A "Custom Skill" (Python script) can be successfully called by the agent to perform a specific task.
- [ ] Analysis results can be exported to Excel/PDF.

## Out of Scope
- Training custom LLMs.
- Real-time streaming of data from live production databases (initial focus is on static/connected data sources available in RapidBI).
