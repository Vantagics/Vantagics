import { useState, useEffect } from 'react';
import { GetConfig } from '../wailsjs/go/main/App';
import { EventsOn } from '../wailsjs/runtime/runtime';

export type Language = 'English' | '简体中文';

export const translations: Record<Language, Record<string, string>> = {
    'English': {
        'data_sources': 'Data Sources',
        'chat_analysis': 'Chat Analysis',
        'add_source': '+ Add Source',
        'settings': 'Settings',
        'smart_dashboard': 'Smart Dashboard',
        'welcome_back': "Welcome back! Here's what's happening with your data.",
        'key_metrics': 'Key Metrics',
        'automated_insights': 'Automated Insights',
        'loading_insights': 'Loading your insights...',
        'ai_assistant': 'AI Assistant',
        'ready_to_help': 'Ready to help',
        'history': 'History',
        'new_chat': 'New Chat',
        'clear_history': 'CLEAR HISTORY',
        'what_to_analyze': 'What would you like to analyze?',
        'data_driven_reasoning': 'Data-driven reasoning',
        'visualized_summaries': 'Visualized summaries',
        'insights_at_fingertips': 'Insights at your fingertips',
        'ask_about_sales': 'Ask about sales trends, customer behavior, or request a complex data analysis.',
        'start_new_analysis': 'Start New Analysis',
        'ai_thinking': 'AI is thinking...',
        'clear_history_confirm_title': 'Clear All History?',
        'clear_history_confirm_desc': 'This action cannot be undone. All your chat threads will be permanently deleted.',
        'cancel': 'Cancel',
        'clear': 'Clear History',
        'preferences': 'Preferences',
        'llm_config': 'LLM Configuration',
        'system_params': 'System Parameters',
        'drivers': 'Drivers',
        'run_env': 'Run Environment',
        'save_changes': 'Save Changes',
        'test_connection': 'Test Connection',
        'provider_type': 'Provider Type',
        'api_key': 'API Key',
        'base_url': 'Base URL (Optional)',
        'model_name': 'Model Name',
        'max_tokens': 'Max Tokens',
        'dark_mode': 'Dark Mode',
        'local_cache': 'Local Cache',
        'detailed_log': 'Detailed Log',
        'language': 'Language',
        'max_preview_rows': 'Max Preview Rows',
        'data_cache_dir': 'Data Cache Directory',
        'browse': 'Browse...',
        'add_data_source': 'Add Data Source',
        'source_name': 'Source Name',
        'driver_type': 'Driver Type',
        'file_path': 'File Path',
        'host': 'Host',
        'port': 'Port',
        'user': 'User',
        'password': 'Password',
        'database': 'Database',
        'store_locally': 'Store Locally',
        'import': 'Import',
        'importing': 'Importing',
        'properties': 'Properties',
        'created_at': 'Created At',
        'yes': 'Yes',
        'no': 'No',
        'close': 'Close',
        'db_path': 'DB Path',
        'err_same_source_target': 'Cannot export to the same database as the source.',
        'export_success': 'Data source "{0}" exported to "{1}" successfully.',
        'export_failed': 'Data source "{0}" export to "{1}" failed.\nError: {2}',
        'view_memory': 'View Memory',
        'view_results_directory': 'View Results Directory',
        'agent_memory': 'Agent Memory',
        'short_term_memory': 'Short Term',
        'medium_term_memory': 'Medium Term',
        'long_term_memory': 'Long Term',
        'test_connection_success': 'Connection successful!',
        'test_connection_failed': 'Connection failed',
        'confirm': 'Confirm',
        'start_analysis_confirm': 'Do you want to start analysis for "{0}"?',
        'start_analysis_title': 'Start Analysis',
        'analyze_suggestions_prompt': 'Give me some analysis suggestions for this data source.',
        'analysis_session_prefix': 'Analysis: ',
        'replay_analysis': 'Replay Analysis',
        'data_summary': 'Data Summary',
        'table_schema': 'Table Schema',
        'select_data_source': 'Select Data Source',
        'select_data_source_message': 'Please select a data source first, then start the analysis.',
        'delete_data_source_title': 'Delete Data Source',
        'delete_data_source_message': 'Are you sure you want to delete "{0}"? This action cannot be undone and will remove all associated data and configurations.',
        'delete_data_source_confirm': 'Delete',
        'delete_thread_title': 'Delete Chat Thread',
        'delete_thread_message': 'Are you sure you want to delete the chat thread "{0}"? This action cannot be undone and will remove all messages in this conversation.',
        'delete_thread_confirm': 'Delete',
    },
    '简体中文': {
        'data_sources': '数据源',
        'chat_analysis': '对话分析',
        'add_source': '+ 添加数据源',
        'settings': '设置',
        'smart_dashboard': '智能仪表盘',
        'welcome_back': '欢迎回来！这是您的最新数据概览。',
        'key_metrics': '核心指标',
        'automated_insights': '自动化洞察',
        'loading_insights': '正在加载您的洞察数据...',
        'ai_assistant': 'AI 助手',
        'ready_to_help': '随时准备为您提供帮助',
        'history': '历史记录',
        'new_chat': '新建对话',
        'clear_history': '清空历史记录',
        'what_to_analyze': '您想分析什么？',
        'data_driven_reasoning': '数据驱动推理',
        'visualized_summaries': '可视化摘要',
        'insights_at_fingertips': '洞察近在咫尺',
        'ask_about_sales': '您可以询问销售趋势、用户行为，或请求复杂的数据分析。',
        'start_new_analysis': '开始新分析',
        'ai_thinking': 'AI 正在思考...',
        'clear_history_confirm_title': '清空所有历史记录？',
        'clear_history_confirm_desc': '此操作无法撤销。您的所有聊天记录都将被永久删除。',
        'cancel': '取消',
        'clear': '清空历史',
        'preferences': '系统偏好设置',
        'llm_config': 'LLM 配置',
        'system_params': '系统参数',
        'drivers': '驱动程序',
        'run_env': '运行环境',
        'save_changes': '保存更改',
        'test_connection': '测试连接',
        'provider_type': '供应商类型',
        'api_key': 'API 密钥',
        'base_url': '基础 URL (可选)',
        'model_name': '模型名称',
        'max_tokens': '最大 Token 数',
        'dark_mode': '深色模式',
        'local_cache': '本地缓存',
        'detailed_log': '详细日志',
        'language': '语言',
        'max_preview_rows': '数据预览行数',
        'data_cache_dir': '数据缓存目录',
        'browse': '浏览...',
        'add_data_source': '添加数据源',
        'source_name': '数据源名称',
        'driver_type': '驱动类型',
        'file_path': '文件路径',
        'host': '主机',
        'port': '端口',
        'user': '用户名',
        'password': '密码',
        'database': '数据库',
        'store_locally': '存储至本地',
        'import': '导入',
        'importing': '正在导入',
        'properties': '属性',
        'created_at': '创建时间',
        'yes': '是',
        'no': '否',
        'close': '关闭',
        'db_path': '数据库路径',
        'err_same_source_target': '源数据库与目标数据库不能相同。',
        'export_success': '数据源 "{0}" 导出到 "{1}" 成功。',
        'export_failed': '数据源 "{0}" 导出到 "{1}" 失败。\n错误：{2}',
        'view_memory': '查看记忆',
        'view_results_directory': '查看结果目录',
        'agent_memory': 'Agent 记忆',
        'short_term_memory': '短期记忆',
        'medium_term_memory': '中期记忆',
        'long_term_memory': '长期记忆',
        'test_connection_success': '连接成功！',
        'test_connection_failed': '连接失败',
        'confirm': '确定',
        'start_analysis_confirm': '您确定要对 "{0}" 启动分析吗？',
        'start_analysis_title': '启动分析',
        'analyze_suggestions_prompt': '请给出一些本数据源的分析建议。',
        'analysis_session_prefix': '分析：',
        'replay_analysis': '分析重放',
        'data_summary': '数据摘要',
        'table_schema': '表结构',
        'select_data_source': '选择数据源',
        'select_data_source_message': '请先选择一个数据源，然后再开始分析。',
        'delete_data_source_title': '删除数据源',
        'delete_data_source_message': '您确定要删除 "{0}" 吗？此操作无法撤销，将删除所有相关数据和配置。',
        'delete_data_source_confirm': '删除',
        'delete_thread_title': '删除聊天会话',
        'delete_thread_message': '您确定要删除聊天会话 "{0}" 吗？此操作无法撤销，将删除此对话中的所有消息。',
        'delete_thread_confirm': '删除',
    }
};

export function useLanguage() {
    const [language, setLanguage] = useState<Language>('English');

    const updateLanguage = () => {
        GetConfig().then(config => {
            if (config.language === '简体中文' || config.language === 'English') {
                setLanguage(config.language as Language);
            }
        }).catch(console.error);
    };

    useEffect(() => {
        updateLanguage();
        // Listen for config changes
        const unsubscribe = EventsOn('config-updated', () => {
            updateLanguage();
        });
        return () => {
            if (unsubscribe) unsubscribe();
        };
    }, []);

    const t = (key: string) => {
        return translations[language][key] || key;
    };

    return { language, t };
}
