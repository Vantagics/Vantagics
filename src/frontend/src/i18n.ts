import { useState, useEffect } from 'react';
import { GetConfig } from '../wailsjs/go/main/App';
import { EventsOn } from '../wailsjs/runtime/runtime';

export type Language = 'English' | '简体中文';

export const translations: Record<Language, Record<string, string>> = {
    'English': {
        // Application Menu
        'menu_file': 'File',
        'menu_settings': 'Settings',
        'menu_exit': 'Exit',
        'menu_help': 'Help',
        'menu_about': 'About',
        'app_title': 'VantageData - Smart Data Analysis',
        // Data Sources
        'data_sources': 'Data Sources',
        'chat_analysis': 'Chat Analysis',
        'add_source': '+ Add Source',
        'settings': 'Settings',
        'smart_dashboard': 'Smart Dashboard',
        'welcome_back': "Welcome back! Here's what's happening with your data.",
        'key_metrics': 'Key Metrics',
        'automated_insights': 'Automated Insights',
        'loading_insights': 'Loading your insights...',
        'ai_assistant': 'AI Assistant',
        'ready_to_help': 'Ready to help',
        'history': 'History',
        'new_chat': 'New Chat',
        'clear_history': 'CLEAR HISTORY',
        'collapse_chat': 'Collapse Chat',
        'chat_area': 'Chat',
        'what_to_analyze': 'What would you like to analyze?',
        'data_driven_reasoning': 'Data-driven reasoning',
        'visualized_summaries': 'Visualized summaries',
        'insights_at_fingertips': 'Insights at your fingertips',
        'ask_about_sales': 'Ask about sales trends, customer behavior, or request a complex data analysis.',
        'start_new_analysis': 'Start New Analysis',
        'ai_thinking': 'AI is thinking...',
        'clear_history_confirm_title': 'Clear All History?',
        'clear_history_confirm_desc': 'This action cannot be undone. All your chat threads will be permanently deleted.',
        'cancel': 'Cancel',
        'clear': 'Clear History',
        'preferences': 'Preferences',
        'llm_config': 'LLM Configuration',
        'system_params': 'System Parameters',
        'mcp_services': 'MCP Services',
        'drivers': 'Drivers',
        'run_env': 'Run Environment',
        'save_changes': 'Save Changes',
        'test_connection': 'Test Connection',
        'provider_type': 'Provider Type',
        'api_key': 'API Key',
        'base_url': 'Base URL (Optional)',
        'model_name': 'Model Name',
        'max_tokens': 'Max Tokens',
        'dark_mode': 'Dark Mode',
        'local_cache': 'Local Cache',
        'detailed_log': 'Detailed Log',
        'enable_memory': 'Enable Memory',
        'enable_memory_desc': 'Enable context memory management (may affect simple query speed)',
        'auto_analysis_suggestions': 'Auto Analysis Suggestions',
        'auto_analysis_suggestions_desc': 'Automatically generate analysis suggestions when creating a new session',
        'session_management': 'Session Management',
        'session_management_desc': 'Configure session behavior and AI assistant features',
        'language': 'Language',
        'max_preview_rows': 'Max Preview Rows',
        'max_concurrent_analysis': 'Max Concurrent Analysis',
        'max_concurrent_analysis_hint': 'Maximum number of concurrent analysis tasks (1-10, default 5)',
        'data_cache_dir': 'Data Cache Directory',
        'browse': 'Browse...',
        'location_settings': 'Location Settings',
        'location_settings_desc': 'Set your location for weather queries, nearby places, and other location-based features',
        'country': 'Country',
        'city': 'City',
        'select_country': 'Select Country',
        'select_city': 'Select City',
        'location_set': 'Location set',
        'add_data_source': 'Add Data Source',
        'source_name': 'Source Name',
        'driver_type': 'Driver Type',
        'file_path': 'File Path',
        'host': 'Host',
        'port': 'Port',
        'user': 'User',
        'password': 'Password',
        'database': 'Database',
        'store_locally': 'Store Locally',
        'import': 'Import',
        'importing': 'Importing',
        'properties': 'Properties',
        'created_at': 'Created At',
        'yes': 'Yes',
        'no': 'No',
        'close': 'Close',
        'about': 'About',
        'version': 'Version',
        'build_date': 'Build Date',
        // Search API
        'search_engine': 'Search API',
        'search_engine_settings': 'Search API Settings',
        'search_engine_description': 'Configure search API for web search capabilities',
        'active_search_engine': 'Active Search API',
        'available_engines': 'Available Engines',
        'add_custom_engine': 'Add Custom Engine',
        'search_engine_hint': 'Chinese users default to Bing, English users default to Google',
        'search_engine_name': 'Search API Name',
        'search_engine_url': 'Search API URL',
        'search_engine_url_hint': 'Enter the base domain (e.g., duckduckgo.com or www.ecosia.org)',
        'search_engine_test_required': 'Please test the search API before saving',
        'edit_search_engine': 'Edit Search API',
        'active': 'Active',
        'db_path': 'DB Path',
        'err_same_source_target': 'Cannot export to the same database as the source.',
        'export_success': 'Data source "{0}" exported to "{1}" successfully.',
        'export_failed': 'Data source "{0}" export to "{1}" failed.\nError: {2}',
        'view_memory': 'View Memory',
        'view_results_directory': 'View Results Directory',
        'agent_memory': 'Agent Memory',
        'short_term_memory': 'Short Term',
        'medium_term_memory': 'Medium Term',
        'long_term_memory': 'Long Term',
        'short_term_memory_title': 'Short-Term Memory (Current Context)',
        'short_term_memory_desc': 'Recent messages kept in full detail. This is the active working memory used for immediate reasoning and responses.',
        'medium_term_memory_title': 'Mid-Term Memory (Compressed Summaries)',
        'medium_term_memory_desc': 'Older conversation segments automatically compressed by AI. Key topics and findings are preserved while details are condensed to save context space.',
        'long_term_memory_title': 'Long-Term Memory (Persistent Facts)',
        'long_term_memory_desc': 'Persistent knowledge extracted from analysis: data source schemas, business rules, data characteristics. These facts are reusable across the session.',
        'no_short_term_memory': 'No recent conversation yet.',
        'no_medium_term_memory': 'No compressed history yet. Summaries are created automatically when conversation grows.',
        'no_long_term_memory': 'No persistent facts extracted yet. Facts are learned from data analysis and user definitions.',
        'test_connection_success': 'Connection successful!',
        'test_connection_failed': 'Connection failed',
        'confirm': 'Confirm',
        'start_analysis_confirm': 'Do you want to start analysis for "{0}"?',
        'start_analysis_title': 'Start Analysis',
        'analyze_suggestions_prompt': 'Give me some analysis suggestions for this data source.',
        'generate_analysis_suggestions': 'Generate Analysis Suggestions',
        'analysis_session_prefix': 'Analysis: ',
        'replay_analysis': 'Replay Analysis',
        'data_summary': 'Data Summary',
        'table_schema': 'Table Schema',
        'select_data_source': 'Select Data Source',
        'select_data_source_message': 'Please select a data source first, then start the analysis.',
        'no_data_source_prompt_title': 'No Data Source Selected',
        'no_data_source_prompt_message': 'Please select a data source before starting analysis. Click "Confirm" to start a free chat, or "Cancel" to go back.',
        'delete_data_source_title': 'Delete Data Source',
        'delete_data_source_message': 'Are you sure you want to delete "{0}"? This action cannot be undone and will remove all associated data and configurations.',
        'delete_data_source_confirm': 'Delete',
        'delete_thread_title': 'Delete Chat Thread',
        'delete_thread_message': 'Are you sure you want to delete the chat thread "{0}"? This action cannot be undone and will remove all messages in this conversation.',
        'delete_thread_confirm': 'Delete',
        'deleting': 'Deleting...',
        'analysis_in_progress': 'Analysis in progress. Please wait for the current analysis to complete before starting a new one.',
        'previous': 'Previous',
        'next': 'Next',
        'previous_chart': 'Previous chart',
        'next_chart': 'Next chart',
        'no_data_sources_yet': 'No data sources added yet.',
        'skills': 'Skills',
        'skills_management': 'Skills Management',
        'skills_installed': 'installed',
        'skills_enabled': 'enabled',
        'search_skills': 'Search Skills (by name or description)...',
        'auto_intent_understanding': 'Auto Intent Understanding',
        'auto_intent_understanding_desc': 'Generate multiple intent interpretations before analysis to avoid misunderstanding',
        'auto_intent_understanding_enabled': 'Auto intent understanding enabled',
        'auto_intent_understanding_disabled': 'Auto intent understanding disabled',
        'intent_understanding_disabled_warning': 'Recommended for professional users only. Disabling intent understanding may lead to analysis misinterpretation.',
        'select_your_intent': 'Select Your Analysis Intent',
        'intent_selection_desc': 'The system has understood your request. Please select the analysis direction that best matches your intent.',
        'generating_intent': 'Understanding your intent...',
        'click_suggestion_to_continue': 'Click a suggestion above to continue analysis',
        'retry_intent_understanding': 'None of the above, re-understand my intent',
        'stick_to_original': 'Stick to my original request',
        'excluded_count': '{count} option(s) excluded',
        'too_many_exclusions_warning': 'You have excluded many options. Consider using your original request or rephrasing your question.',
        'no_more_suggestions': 'No more suggestions',
        'no_more_suggestions_desc': 'The system cannot generate more different intent suggestions.',
        'intent_generation_failed': 'Intent generation failed. Please retry or use your original request.',
        'click_to_use_original': 'Click above to use your original request for analysis',
        'regenerating_intent': 'Re-understanding your intent...',
        'intent_retry_error': 'Failed to retry intent understanding. Please resend your message.',
        'stick_to_original_error': 'Cannot use original request. Please resend your message.',
        'retry_failed': 'Retry failed. Please try again.',
        'skip_and_analyze': 'Skip and Analyze Directly',
        'delete_source': 'Delete source',
        'delete_table': 'Delete table',
        'delete_table_warning': 'Are you sure you want to delete table "{tableName}"? This action cannot be undone.',
        'delete_table_irreversible': 'This operation is irreversible. All data in this table will be permanently deleted.',
        'delete_table_failed': 'Failed to delete table',
        'delete_last_table_warning': 'This is the last table in the data source.',
        'delete_last_table_consequence': 'Deleting this table will also delete the data source "{dataSourceName}" and all associated chat sessions.',
        // Column deletion
        'delete_column': 'Delete column',
        'delete_column_title': 'Delete Column',
        'delete_column_warning': 'Are you sure you want to delete column "{columnName}" from table "{tableName}"? This action cannot be undone.',
        'delete_column_irreversible': 'This operation is irreversible. All data in this column will be permanently deleted.',
        'delete_column_confirm': 'Delete Column',
        'delete_column_failed': 'Failed to delete column',
        'delete_last_column_warning': 'This is the last column in the last table of this data source.',
        'delete_last_column_consequence': 'Deleting this column will delete the entire data source "{dataSourceName}" and all associated chat sessions.',
        'delete_datasource': 'Delete Data Source',
        'select_columns_to_delete': 'Select columns to delete',
        'columns_selected': '{count} column(s) selected',
        'click_column_to_select': 'Click column header to select/deselect',
        // Column editing
        'double_click_to_edit_column': 'Double-click column name to edit',
        'double_click_to_edit': 'Double-click to edit',
        'column_name_empty': 'Column name cannot be empty',
        'column_name_invalid_char': 'Column name contains invalid character: {char}',
        'column_name_starts_with_number': 'Column name cannot start with a number',
        'column_name_duplicate': 'Column name "{name}" already exists',
        'rename_column_failed': 'Failed to rename column',
        'space': 'space',
        'save': 'Save',
        'warning': 'Warning',
        'confirm_delete': 'Confirm Delete',
        'optimization_status': 'Optimization Status',
        'optimized': 'Optimized',
        'not_optimized': 'Not Optimized',
        'optimize_after_import': 'Optimize after import',
        'optimize_description': 'Automatically create indexes to improve query performance',
        'export_data': 'Export Data',
        'optimize_data_source': 'Optimize Data Source',
        'associated_chats': 'Associated Chats',
        'loading': 'Loading',
        'no_associated_chats': 'No associated chats found',
        // ContextPanel (Data Explorer)
        'data_explorer': 'Data Explorer',
        'select_data_source_to_explore': 'Select a data source from the sidebar to explore its contents.',
        'loading_data': 'Loading data...',
        'no_data_in_table': 'No data found in this table.',
        'tables': 'Tables',
        'back_to_tables': '← BACK TO TABLES',
        'showing_preview_rows': 'Showing up to {0} rows preview',
        'source': 'Source',
        'table': 'Table',
        'rows': 'Rows',
        // ChatSidebar
        'no_threads_yet': 'No threads yet',
        'cancel_analysis': 'Cancel',
        'cancel_analysis_title': 'Cancel Analysis',
        'cancel_analysis_message': 'Are you sure you want to cancel the current analysis? This action cannot be undone.',
        // Dashboard
        'double_click_to_zoom': 'Double click to zoom',
        'chart_data_format_error': 'Chart Data Format Error',
        'chart_contains_functions': 'This chart contains JavaScript functions and cannot be displayed. The data has been corrupted.',
        'export_dashboard': 'Export Dashboard',
        'export_as_html': 'Export as HTML',
        'export_as_pdf': 'Export as PDF',
        'no_exportable_content': 'No content available to export',
        'chart_type': 'Chart Type',
        'export_time': 'Export Time',
        'generated_by': 'Generated by VantageData Smart Dashboard',
        'view_in_system': 'For interactive charts and real-time data, please visit the original system',
        'analysis_request': 'Analysis Request',
        'dashboard_report': 'Smart Dashboard Report',
        'generated_at': 'Generated at',
        'no_visualization_results': 'This analysis request has no visualization results yet.',
        'latest_analysis': 'Latest Analysis',
        // ExportDataSourceModal
        'select_tables': 'Select Tables',
        'select_all': 'Select All',
        'deselect_all': 'Deselect All',
        'no_tables_found': 'No tables found',
        'tables_selected': '{0} of {1} table(s) selected',
        'export_format': 'Export Format',
        'mysql_database': 'MySQL Database',
        'connect_to_server': 'Connect to Server',
        'connecting': 'Connecting...',
        'select_database': 'Select Database',
        'select_existing_database': '-- Select Existing Database --',
        'or_create_new': 'Or create new',
        'enter_new_database_name': 'Enter new database name',
        'connected_to': 'Connected to {0}:{1}',
        'back': 'Back',
        'connection': 'Connection',
        'please_connect_mysql': 'Please connect to MySQL server first.',
        'please_select_database': 'Please select a database.',
        'export': 'Export',
        'exporting': 'Exporting...',
        'please_select_table': 'Please select at least one table to export.',
        'username': 'Username',
        // NewChatModal
        'session_name': 'Session Name',
        'session_name_placeholder': 'e.g. Sales Analysis Q1',
        'validating': 'Validating...',
        'start_chat': 'Start Chat',
        'session_already_exists': 'A session named "{0}" already exists for this data source.',
        // Settings/Preferences
        'settings_saved_successfully': 'Settings saved successfully!',
        'settings_save_failed': 'Failed to save settings',
        // System Startup
        'system_startup': 'System Startup',
        'initializing': 'Initializing...',
        'checking_llm_config': 'Checking LLM Configuration...',
        'testing_llm_connection': 'Testing LLM Connection...',
        'api_key_missing': 'API Key is missing. Please configure LLM settings.',
        'connection_test_failed': 'Connection Test Failed',
        'open_settings': 'Open Settings',
        'retry_connection': 'Retry Connection',
        // MCP Services
        'mcp_services_title': 'MCP Services',
        'mcp_services_description': 'Configure Model Context Protocol services for extended capabilities',
        'add_mcp_service': 'Add MCP Service',
        'edit_mcp_service': 'Edit MCP Service',
        'mcp_service_name': 'Service Name',
        'mcp_service_description': 'Description',
        'mcp_service_url': 'Service URL',
        'mcp_service_enabled': 'Enabled',
        'testing_mcp_service': 'Testing...',
        'test_search_tools': 'Test Search Tools',
        'testing_search_tools': 'Testing Search Tools...',
        'test_search_tools_hint': 'Tests web_search and web_fetch with query "whitehouse" (may take 60-90 seconds)',
        'search_tools_test_success': 'Search tools test passed! Engine is working correctly.',
        'connection_test_success': 'Connection test passed! Engine is accessible.',
        'mcp_test_success': 'Service is reachable',
        'mcp_test_failed': 'Connection failed',
        'delete_mcp_service': 'Delete Service',
        'no_mcp_services': 'No MCP services configured yet',
        'mcp_service_name_required': 'Service name is required',
        'mcp_service_url_required': 'Service URL is required',
        'mcp_service_url_invalid': 'Please enter a valid URL (http:// or https://)',
        'mcp_test_required': 'Please test the service connection before saving',
        'tested': 'Tested',
        'not_tested': 'Not Tested',
        'mcp_not_tested_warning': 'This service has not been tested and will not be available to the agent',
        // Network/Proxy Settings
        'network_settings': 'Network Settings',
        'network_settings_description': 'Configure network proxy for web access',
        'proxy_enabled': 'Enable Proxy',
        'proxy_protocol': 'Protocol',
        'proxy_host': 'Host',
        'proxy_port': 'Port',
        'proxy_username': 'Username (Optional)',
        'proxy_password': 'Password (Optional)',
        'test_proxy': 'Test Proxy',
        'testing_proxy': 'Testing...',
        'proxy_test_success': 'Proxy is working',
        'proxy_test_failed': 'Proxy connection failed',
        'proxy_not_tested': 'Not Tested',
        'proxy_tested': 'Tested',
        'proxy_test_required': 'Please test the proxy connection before enabling',
        'proxy_settings': 'Proxy Settings',
        // File Download Area
        'session_files': 'Generated Files',
        'download_success': 'File saved successfully',
        'download_failed': 'Download failed',
        'download_started': 'Download started',
        'loading_preview': 'Loading preview...',
        // Rename Data Source
        'rename': 'Rename',
        'rename_data_source': 'Rename Data Source',
        'data_source_name': 'Data Source Name',
        'enter_data_source_name': 'Enter data source name',
        'data_source_name_required': 'Data source name is required',
        'rename_data_source_note': 'Note: The data source name must be unique.',
        'renaming': 'Renaming...',
        // Dashboard
        'analysis_data': 'Analysis Data',
        'analysis_result': 'Analysis Result',
        // Semantic Optimization
        'semantic_optimize': 'Semantic Optimization',
        'semantic_optimize_desc': 'Use AI to generate meaningful field names for better data understanding',
        'semantic_optimizing': 'Optimizing field names...',
        'semantic_optimize_success': 'Semantic optimization completed! New data source "{0}" has been created.',
        'semantic_optimize_failed': 'Semantic optimization failed',
        'semantic_optimize_note': 'This will create a new data source with optimized field names based on data analysis.',
        'semantic_optimize_warning': 'The process may take several minutes depending on the size of your data.',
        'start_optimize': 'Start Optimization',
        'note': 'Note',
        // Intent Enhancement Settings
        'intent_enhancement': 'Intent Enhancement',
        'intent_enhancement_settings': 'Intent Enhancement Settings',
        'intent_enhancement_description': 'Configure AI-powered intent understanding enhancements',
        'enable_context_enhancement': 'Context Enhancement',
        'enable_context_enhancement_desc': 'Include historical analysis records as context for better suggestions',
        'enable_preference_learning': 'Preference Learning',
        'enable_preference_learning_desc': 'Learn from your intent selections to improve suggestion ranking',
        'enable_dynamic_dimensions': 'Dynamic Dimensions',
        'enable_dynamic_dimensions_desc': 'Automatically adjust analysis dimensions based on data characteristics',
        'enable_few_shot_examples': 'Few-shot Examples',
        'enable_few_shot_examples_desc': 'Include domain-specific examples to improve suggestion quality',
        'enable_caching': 'Intent Caching',
        'enable_caching_desc': 'Cache similar requests to reduce LLM calls and improve response time',
        'cache_settings': 'Cache Settings',
        'cache_similarity_threshold': 'Similarity Threshold',
        'cache_similarity_threshold_desc': 'Minimum similarity score (0-1) for cache hits',
        'cache_expiration_hours': 'Cache Expiration (hours)',
        'cache_expiration_hours_desc': 'How long cached suggestions remain valid',
        'max_cache_entries': 'Max Cache Entries',
        'max_cache_entries_desc': 'Maximum number of cached intent suggestions',
        'max_history_records': 'Max History Records',
        'max_history_records_desc': 'Number of historical analysis records to include in context',
        'reset_to_defaults': 'Reset to Defaults',
        'all_features_enabled': 'All enhancement features are enabled',
        'some_features_disabled': 'Some enhancement features are disabled',
        // Free Chat
        'free_chat': 'Free Chat',
        'start_free_chat': 'Start Free Chat',
        'free_chat_started': 'Free chat session started',
        'start_free_chat_failed': 'Failed to start free chat',
        'free_chat_mode': 'Free Chat Mode',
        'searching_web': 'Searching the web...',
        'free_chat_hint': 'Chat directly with AI without data analysis',
        'search_api': 'Search API',
        'no_search_api': 'No search API configured',
    },
    '简体中文': {
        // 应用程序菜单
        'menu_file': '文件',
        'menu_settings': '设置',
        'menu_exit': '退出',
        'menu_help': '帮助',
        'menu_about': '关于',
        'app_title': '观界 - 智能数据分析',
        // 数据源
        'data_sources': '数据源',
        'chat_analysis': '对话分析',
        'add_source': '+ 添加数据源',
        'settings': '设置',
        'smart_dashboard': '智能仪表盘',
        'welcome_back': '欢迎回来！这是您的最新数据概览。',
        'key_metrics': '核心指标',
        'automated_insights': '自动化洞察',
        'loading_insights': '正在加载您的洞察数据...',
        'ai_assistant': 'AI 助手',
        'ready_to_help': '随时准备为您提供帮助',
        'history': '历史记录',
        'new_chat': '新建对话',
        'clear_history': '清空历史记录',
        'collapse_chat': '收起会话',
        'chat_area': '聊天区',
        'what_to_analyze': '您想分析什么？',
        'data_driven_reasoning': '数据驱动推理',
        'visualized_summaries': '可视化摘要',
        'insights_at_fingertips': '洞察近在咫尺',
        'ask_about_sales': '您可以询问销售趋势、用户行为，或请求复杂的数据分析。',
        'start_new_analysis': '开始新分析',
        'ai_thinking': 'AI 正在思考...',
        'clear_history_confirm_title': '清空所有历史记录？',
        'clear_history_confirm_desc': '此操作无法撤销。您的所有聊天记录都将被永久删除。',
        'cancel': '取消',
        'clear': '清空历史',
        'preferences': '系统偏好设置',
        'llm_config': 'LLM 配置',
        'system_params': '系统参数',
        'mcp_services': 'MCP 服务',
        'drivers': '驱动程序',
        'run_env': '运行环境',
        'save_changes': '保存更改',
        'test_connection': '测试连接',
        'provider_type': '供应商类型',
        'api_key': 'API 密钥',
        'base_url': '基础 URL (可选)',
        'model_name': '模型名称',
        'max_tokens': '最大 Token 数',
        'dark_mode': '深色模式',
        'local_cache': '本地缓存',
        'detailed_log': '详细日志',
        'enable_memory': '启用记忆',
        'enable_memory_desc': '启用上下文记忆管理（可能影响简单查询速度）',
        'auto_analysis_suggestions': '自动分析建议',
        'auto_analysis_suggestions_desc': '创建新会话时自动进行数据源分析建议',
        'session_management': '会话管理',
        'session_management_desc': '配置会话行为和AI助手功能',
        'language': '语言',
        'max_preview_rows': '数据预览行数',
        'max_concurrent_analysis': '最大并发分析任务数',
        'max_concurrent_analysis_hint': '允许同时进行的分析任务数量（1-10，默认5）',
        'data_cache_dir': '数据缓存目录',
        'browse': '浏览...',
        'location_settings': '位置设置',
        'location_settings_desc': '设置您的位置，用于天气查询、附近地点等位置相关功能',
        'country': '国家',
        'city': '城市',
        'select_country': '选择国家',
        'select_city': '选择城市',
        'location_set': '位置已设置',
        'add_data_source': '添加数据源',
        'source_name': '数据源名称',
        'driver_type': '驱动类型',
        'file_path': '文件路径',
        'host': '主机',
        'port': '端口',
        'user': '用户名',
        'password': '密码',
        'database': '数据库',
        'store_locally': '存储至本地',
        'import': '导入',
        'importing': '正在导入',
        'properties': '属性',
        'created_at': '创建时间',
        'yes': '是',
        'no': '否',
        'close': '关闭',
        'about': '关于',
        'version': '版本',
        'build_date': '构建日期',
        // 搜索 API
        'search_engine': '搜索 API',
        'search_engine_settings': '搜索 API 设置',
        'search_engine_description': '配置用于网络搜索的搜索 API',
        'active_search_engine': '活动搜索 API',
        'available_engines': '可用引擎',
        'add_custom_engine': '添加自定义引擎',
        'search_engine_hint': '中文用户默认使用 Bing，英文用户默认使用 Google',
        'search_engine_name': '搜索 API 名称',
        'search_engine_url': '搜索 API URL',
        'search_engine_url_hint': '输入基础域名（例如：duckduckgo.com 或 www.ecosia.org）',
        'search_engine_test_required': '保存前请先测试搜索 API',
        'edit_search_engine': '编辑搜索 API',
        'active': '活动',
        'db_path': '数据库路径',
        'err_same_source_target': '源数据库与目标数据库不能相同。',
        'export_success': '数据源 "{0}" 导出到 "{1}" 成功。',
        'export_failed': '数据源 "{0}" 导出到 "{1}" 失败。\n错误：{2}',
        'view_memory': '查看记忆',
        'view_results_directory': '查看结果目录',
        'agent_memory': 'Agent 记忆',
        'short_term_memory': '短期记忆',
        'medium_term_memory': '中期记忆',
        'long_term_memory': '长期记忆',
        'short_term_memory_title': '短期记忆（当前上下文）',
        'short_term_memory_desc': '最近的消息以完整细节保留。这是用于即时推理和响应的活跃工作记忆。',
        'medium_term_memory_title': '中期记忆（压缩摘要）',
        'medium_term_memory_desc': '较旧的对话片段由 AI 自动压缩。保留关键主题和发现，同时压缩细节以节省上下文空间。',
        'long_term_memory_title': '长期记忆（持久化事实）',
        'long_term_memory_desc': '从分析中提取的持久化知识：数据源架构、业务规则、数据特征。这些事实可在整个会话中复用。',
        'no_short_term_memory': '暂无最近的对话。',
        'no_medium_term_memory': '暂无压缩历史。当对话增长时会自动创建摘要。',
        'no_long_term_memory': '暂无提取的持久化事实。事实从数据分析和用户定义中学习。',
        'test_connection_success': '连接成功！',
        'test_connection_failed': '连接失败',
        'confirm': '确定',
        'start_analysis_confirm': '您确定要对 "{0}" 启动分析吗？',
        'start_analysis_title': '启动分析',
        'analyze_suggestions_prompt': '请给出一些本数据源的分析建议。',
        'generate_analysis_suggestions': '生成分析建议',
        'analysis_session_prefix': '分析：',
        'replay_analysis': '分析重放',
        'data_summary': '数据摘要',
        'table_schema': '表结构',
        'select_data_source': '选择数据源',
        'select_data_source_message': '请先选择一个数据源，然后再开始分析。',
        'no_data_source_prompt_title': '未选择数据源',
        'no_data_source_prompt_message': '对话分析前请选择数据源。点击"确定"开启随意聊，点击"取消"返回。',
        'delete_data_source_title': '删除数据源',
        'delete_data_source_message': '您确定要删除 "{0}" 吗？此操作无法撤销，将删除所有相关数据和配置。',
        'delete_data_source_confirm': '删除',
        'delete_thread_title': '删除聊天会话',
        'delete_thread_message': '您确定要删除聊天会话 "{0}" 吗？此操作无法撤销，将删除此对话中的所有消息。',
        'delete_thread_confirm': '删除',
        'deleting': '删除中...',
        'analysis_in_progress': '分析进行中，请等待当前分析完成后再发起新的分析',
        'previous': '上一个',
        'next': '下一个',
        'previous_chart': '上一张图',
        'next_chart': '下一张图',
        'no_data_sources_yet': '还没有添加数据源。',
        'skills': '技能',
        'skills_management': 'Skills管理',
        'skills_installed': '个已安装',
        'skills_enabled': '个已启用',
        'search_skills': '搜索 Skills（按名称或描述）...',
        'auto_intent_understanding': '自动意图理解',
        'auto_intent_understanding_desc': '在分析前生成多个意图理解供选择，避免理解偏差',
        'auto_intent_understanding_enabled': '已启用自动意图理解',
        'auto_intent_understanding_disabled': '已关闭自动意图理解',
        'intent_understanding_disabled_warning': '建议仅专业用户关闭意图理解功能',
        'select_your_intent': '请选择您的分析意图',
        'intent_selection_desc': '系统理解了您的请求，请选择最符合您意图的分析方向',
        'generating_intent': '意图理解中...',
        'click_suggestion_to_continue': '点击上方建议继续分析',
        'retry_intent_understanding': '以上都不是我所想的，重新理解意图',
        'stick_to_original': '坚持我的请求',
        'excluded_count': '已排除 {count} 个选项',
        'too_many_exclusions_warning': '您已排除了较多选项，建议使用原始请求或重新表述您的问题。',
        'no_more_suggestions': '没有更多建议',
        'no_more_suggestions_desc': '系统已无法生成更多不同的意图建议。',
        'intent_generation_failed': '意图生成失败，请重试或使用原始请求',
        'click_to_use_original': '点击上方选项使用原始请求进行分析',
        'regenerating_intent': '意图理解中...',
        'intent_retry_error': '重新理解失败，请重新发送消息',
        'stick_to_original_error': '无法使用原始请求，请重新发送消息',
        'retry_failed': '重新理解失败，请重试',
        'skip_and_analyze': '跳过并直接分析',
        'delete_source': '删除数据源',
        'delete_table': '删除表',
        'delete_table_warning': '您确定要删除表 "{tableName}" 吗？此操作无法撤销。',
        'delete_table_irreversible': '此操作不可逆。该表中的所有数据将被永久删除。',
        'delete_table_failed': '删除表失败',
        'delete_last_table_warning': '这是数据源中的最后一个表。',
        'delete_last_table_consequence': '删除此表将同时删除数据源 "{dataSourceName}" 及其所有关联的会话。',
        // 列删除
        'delete_column': '删除列',
        'delete_column_title': '删除列',
        'delete_column_warning': '您确定要删除表 "{tableName}" 中的列 "{columnName}" 吗？此操作无法撤销。',
        'delete_column_irreversible': '此操作不可逆。该列中的所有数据将被永久删除。',
        'delete_column_confirm': '删除列',
        'delete_column_failed': '删除列失败',
        'delete_last_column_warning': '这是该数据源最后一个表的最后一列。',
        'delete_last_column_consequence': '删除此列将同时删除整个数据源 "{dataSourceName}" 及其所有关联的会话。',
        'delete_datasource': '删除数据源',
        'select_columns_to_delete': '选择要删除的列',
        'columns_selected': '已选择 {count} 列',
        'click_column_to_select': '点击列标题选择/取消选择',
        // 字段编辑
        'double_click_to_edit_column': '双击字段名可编辑',
        'double_click_to_edit': '双击编辑',
        'column_name_empty': '字段名不能为空',
        'column_name_invalid_char': '字段名包含非法字符：{char}',
        'column_name_starts_with_number': '字段名不能以数字开头',
        'column_name_duplicate': '字段名 "{name}" 已存在',
        'rename_column_failed': '重命名字段失败',
        'space': '空格',
        'save': '保存',
        'warning': '警告',
        'confirm_delete': '确认删除',
        'optimization_status': '优化状态',
        'optimized': '已优化',
        'not_optimized': '未优化',
        'optimize_after_import': '导入后优化数据',
        'optimize_description': '自动创建索引以提升查询性能',
        'export_data': '导出数据',
        'optimize_data_source': '数据源优化',
        'associated_chats': '关联的对话',
        'loading': '加载中',
        'no_associated_chats': '未找到关联的对话',
        // ContextPanel (Data Explorer)
        'data_explorer': '数据浏览器',
        'select_data_source_to_explore': '从侧边栏选择一个数据源以浏览其内容。',
        'loading_data': '加载数据中...',
        'no_data_in_table': '此表中未找到数据。',
        'tables': '表',
        'back_to_tables': '← 返回表列表',
        'showing_preview_rows': '显示最多 {0} 行预览',
        'source': '数据源',
        'table': '表',
        'rows': '行',
        // ChatSidebar
        'no_threads_yet': '还没有会话',
        'cancel_analysis': '取消',
        'cancel_analysis_title': '取消分析',
        'cancel_analysis_message': '您确定要取消当前分析吗？此操作无法撤销。',
        // Dashboard
        'double_click_to_zoom': '双击放大',
        'chart_data_format_error': '图表数据格式错误',
        'chart_contains_functions': '此图表包含 JavaScript 函数，无法显示。数据已损坏。',
        'export_dashboard': '导出仪表盘',
        'export_as_html': '导出为 HTML',
        'export_as_pdf': '导出为 PDF',
        'no_exportable_content': '没有可导出的内容',
        'chart_type': '图表类型',
        'export_time': '导出时间',
        'generated_by': '由 VantageData 智能仪表盘生成',
        'view_in_system': '如需查看交互式图表和实时数据，请访问原系统',
        'analysis_request': '分析请求',
        'dashboard_report': '智能仪表盘报告',
        'generated_at': '生成时间',
        'no_visualization_results': '此分析请求尚无可视化结果。',
        'latest_analysis': '最新分析',
        // ExportDataSourceModal
        'select_tables': '选择表',
        'select_all': '全选',
        'deselect_all': '取消全选',
        'no_tables_found': '未找到表',
        'tables_selected': '已选择 {0} / {1} 个表',
        'export_format': '导出格式',
        'mysql_database': 'MySQL 数据库',
        'connect_to_server': '连接到服务器',
        'connecting': '连接中...',
        'select_database': '选择数据库',
        'select_existing_database': '-- 选择现有数据库 --',
        'or_create_new': '或创建新数据库',
        'enter_new_database_name': '输入新数据库名称',
        'connected_to': '已连接到 {0}:{1}',
        'back': '返回',
        'connection': '连接',
        'please_connect_mysql': '请先连接到 MySQL 服务器。',
        'please_select_database': '请选择一个数据库。',
        'export': '导出',
        'exporting': '导出中...',
        'please_select_table': '请至少选择一个表进行导出。',
        'username': '用户名',
        // NewChatModal
        'session_name': '会话名称',
        'session_name_placeholder': '例如：第一季度销售分析',
        'validating': '验证中...',
        'start_chat': '开始对话',
        'session_already_exists': '此数据源已存在名为"{0}"的会话。',
        // Settings/Preferences
        'settings_saved_successfully': '设置保存成功！',
        'settings_save_failed': '设置保存失败',
        // System Startup
        'system_startup': '系统启动',
        'initializing': '初始化中...',
        'checking_llm_config': '检查LLM配置...',
        'testing_llm_connection': '测试LLM连接...',
        'api_key_missing': 'API密钥缺失。请配置LLM设置。',
        'connection_test_failed': '连接测试失败',
        'open_settings': '打开设置',
        'retry_connection': '重试连接',
        // MCP 服务
        'mcp_services_title': 'MCP 服务',
        'mcp_services_description': '配置模型上下文协议服务以扩展功能',
        'add_mcp_service': '添加 MCP 服务',
        'edit_mcp_service': '编辑 MCP 服务',
        'mcp_service_name': '服务名称',
        'mcp_service_description': '描述',
        'mcp_service_url': '服务 URL',
        'mcp_service_enabled': '启用',
        'testing_mcp_service': '测试中...',
        'test_search_tools': '测试搜索工具',
        'testing_search_tools': '正在测试搜索工具...',
        'test_search_tools_hint': '使用关键词 "whitehouse" 测试 web_search 和 web_fetch（可能需要 60-90 秒）',
        'search_tools_test_success': '搜索工具测试通过！引擎工作正常。',
        'connection_test_success': '连接测试通过！引擎可访问。',
        'mcp_test_success': '服务可访问',
        'mcp_test_failed': '连接失败',
        'delete_mcp_service': '删除服务',
        'no_mcp_services': '尚未配置 MCP 服务',
        'mcp_service_name_required': '服务名称不能为空',
        'mcp_service_url_required': '服务 URL 不能为空',
        'mcp_service_url_invalid': '请输入有效的 URL（http:// 或 https://）',
        'mcp_test_required': '保存前请先测试服务连接',
        'tested': '已测试',
        'not_tested': '未测试',
        'mcp_not_tested_warning': '此服务未经测试，Agent 将无法使用',
        // 网络/代理设置
        'network_settings': '网络设置',
        'network_settings_description': '配置网络代理以访问网络',
        'proxy_enabled': '启用代理',
        'proxy_protocol': '协议',
        'proxy_host': '主机',
        'proxy_port': '端口',
        'proxy_username': '用户名（可选）',
        'proxy_password': '密码（可选）',
        'test_proxy': '测试代理',
        'testing_proxy': '测试中...',
        'proxy_test_success': '代理工作正常',
        'proxy_test_failed': '代理连接失败',
        'proxy_not_tested': '未测试',
        'proxy_tested': '已测试',
        'proxy_test_required': '启用前请先测试代理连接',
        'proxy_settings': '代理设置',
        // 文件下载区域
        'session_files': '生成的文件',
        'download_success': '文件保存成功',
        'download_failed': '下载失败',
        'download_started': '下载已开始',
        'loading_preview': '加载预览中...',
        // 重命名数据源
        'rename': '重命名',
        'rename_data_source': '重命名数据源',
        'data_source_name': '数据源名称',
        'enter_data_source_name': '输入数据源名称',
        'data_source_name_required': '数据源名称不能为空',
        'rename_data_source_note': '注意：数据源名称必须唯一。',
        'renaming': '重命名中...',
        // 仪表盘
        'analysis_data': '分析数据',
        'analysis_result': '分析结果',
        // 语义优化
        'semantic_optimize': '语义优化',
        'semantic_optimize_desc': '使用 AI 生成有意义的字段名，提升数据理解',
        'semantic_optimizing': '正在优化字段名...',
        'semantic_optimize_success': '语义优化完成！已创建新数据源 "{0}"。',
        'semantic_optimize_failed': '语义优化失败',
        'semantic_optimize_note': '这将创建一个新的数据源，其字段名基于数据分析进行了优化。',
        'semantic_optimize_warning': '此过程可能需要几分钟，具体取决于数据大小。',
        'start_optimize': '开始优化',
        'note': '注意',
        // Intent Enhancement Settings
        'intent_enhancement': '意图增强',
        'intent_enhancement_settings': '意图增强设置',
        'intent_enhancement_description': '配置AI驱动的意图理解增强功能',
        'enable_context_enhancement': '上下文增强',
        'enable_context_enhancement_desc': '将历史分析记录作为上下文，提供更相关的建议',
        'enable_preference_learning': '偏好学习',
        'enable_preference_learning_desc': '从您的意图选择中学习，优化建议排序',
        'enable_dynamic_dimensions': '动态维度',
        'enable_dynamic_dimensions_desc': '根据数据特征自动调整分析维度建议',
        'enable_few_shot_examples': 'Few-shot示例',
        'enable_few_shot_examples_desc': '包含领域特定示例以提高建议质量',
        'enable_caching': '意图缓存',
        'enable_caching_desc': '缓存相似请求以减少LLM调用并提高响应速度',
        'cache_settings': '缓存设置',
        'cache_similarity_threshold': '相似度阈值',
        'cache_similarity_threshold_desc': '缓存命中所需的最小相似度分数（0-1）',
        'cache_expiration_hours': '缓存过期时间（小时）',
        'cache_expiration_hours_desc': '缓存建议的有效时长',
        'max_cache_entries': '最大缓存条目数',
        'max_cache_entries_desc': '缓存的最大意图建议数量',
        'max_history_records': '最大历史记录数',
        'max_history_records_desc': '上下文中包含的历史分析记录数量',
        'reset_to_defaults': '恢复默认设置',
        'all_features_enabled': '所有增强功能已启用',
        'some_features_disabled': '部分增强功能已禁用',
        // 随意聊
        'free_chat': '随意聊',
        'start_free_chat': '开始随意聊',
        'free_chat_started': '随意聊会话已开始',
        'start_free_chat_failed': '开始随意聊失败',
        'free_chat_mode': '随意聊模式',
        'searching_web': '正在搜索网络信息...',
        'free_chat_hint': '直接与AI对话，无需数据分析',
        'search_api': '搜索API',
        'no_search_api': '未配置搜索API',
    }
};

export function useLanguage() {
    const [language, setLanguage] = useState<Language>('English');

    const updateLanguage = () => {
        GetConfig().then(config => {
            if (config.language === '简体中文' || config.language === 'English') {
                setLanguage(config.language as Language);
            }
        }).catch(console.error);
    };

    useEffect(() => {
        updateLanguage();
        // Listen for config changes
        const unsubscribe = EventsOn('config-updated', () => {
            updateLanguage();
        });
        return () => {
            if (unsubscribe) unsubscribe();
        };
    }, []);

    const t = (key: string, ...params: (string | number)[]) => {
        let text = translations[language][key] || key;
        // Replace {0}, {1}, etc. with provided parameters
        params.forEach((param, index) => {
            text = text.replace(`{${index}}`, String(param));
        });
        return text;
    };

    return { language, t };
}
